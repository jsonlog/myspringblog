<!doctype html>
<html>
<head runat="server">
  <meta charset="utf-8">
  <title>首页_老G博客网站</title>
  <meta name="keywords" content="个人博客,老G个人博客,个人博客模板,老G" />
  <meta name="description" content="老G个人博客，是一个支持springboot个人原创网站。" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="./../css/base.css" rel="stylesheet"/>
  <link href="./../css/index.css" rel="stylesheet"/>
  <link href="./../css/m.css" rel="stylesheet"/>
  <link href="./../css/music.css" rel="stylesheet"/>
  <script src="./../js/jquery.min.js" ></script>
  <link href="./../css/calendar.css" rel="stylesheet" />
  <script src="./../js/calendar.js" type="text/javascript"></script>
  <script src="./../js/fest.js" type="text/javascript"></script>
  <script src="./../js/hc-sticky.js"></script>
  <script src="./../js/comm.js"></script>
  <!--[if lt IE 9]>
  <script src="./../js/modernizr.js"></script>
  <![endif]-->
<!--  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
<!--  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>-->
  <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"/>
</head>
<body>
<div id="header"></div>
<script>
  $("#header").load("./../jsonlog/header.html");
</script>
<div id="wrapper" class="wrapper">
  <form>
    <main id="main" style="width:65%;display:inline-block;vertical-align: top;">
      <div class="bloglist">
        <ul id="bloglistul">
        </ul>
      </div>
      <div id="blogurl">
      </div>
      <div id="container"></div>
    </main>
    <div style="text-align:left;width: 32%;padding-left:30px;display:inline-block;vertical-align: top;">
      <div class="sidebar" id="calendar" style="margin-bottom:15px;" onload="fest();">
      </div>
      <div id="aside">
      </div>
    </div>
  </form>
  <!--  </div>-->
</div>
<script>
  $("#aside").load("./../jsonlog/aside.html");
</script>
<script>
  var share={
    data:function(name,value){
      var top=window.top,
              cache=top['indexhtml']||{};
      top['indexhtml']=cache;
      return value?cache[name]=value:cache[name];
    },
    removeData:function(name){
      var cache=window.top['indexhtml'];
      if(cache&&cache[name])
      {
        delete cache[name];
      }
    }
  };
  var container = document.getElementById("container");
  var realloc = location.href;
  var myloc = realloc.split("&code=");
  var loc = myloc[0];
  // var code = myloc[1];
  var n1 = loc.length;//地址的总长度
  var n2 = loc.indexOf("=");//取得=号的位置
  var dengyu = loc.substr(n2+1, n1-n2);
  if(loc.indexOf("?tag=") != -1)
    var tag = decodeURI(loc.substr(n2+1, n1-n2));//从=号后面的内容
  else if(loc.indexOf("?url=") != -1)
    var url = decodeURI(loc.substr(n2+1, n1-n2));
  var blog;
  var blogtagslist = {};
  var frameonload = 0;
  if(loc[loc.length -1] != "?")
  githubblog();
  function githubblog() {
    $.ajax({
              url: "https://api.github.com/repos/jsonlog/myspringblog/contents/docs/blog",
              async: false,//time
              data: {},
              type: "get",
              dataType: "json",
              success: function (data) {
                blog = [];
                if (data != null) {
                  for (var j = 0; j < data.length; j++) {
                    blog.push(data[j].path.toString().replace("docs/",""));
                  }
                  // blog = ["blog/samplecopy.html"];//test
                  githubblogAdd();
                }
              },
              error: function () {
                console.log("githubajaxerror");
              }
            });
  }
  function urlClick(url) {
    try {
      if(url) {
        // var main = document.getElementById("main");
        // var childs = main.childNodes;
        // for(var i = childs.length - 1; i >= 0; i--) {
        //   if(childs[i].nodeName.toLowerCase().indexOf("div")!= -1)
        //     childs[i].style.display = "none";
        // }

        var bloglist = document.getElementsByClassName("bloglist");
        bloglist[0].style.display = "none";

        var blogurl = document.getElementById("blogurl");
        var urliframe = document.getElementById(url);
        blogurl.innerHTML = urliframe.contentWindow.top[urliframe.src]._bloglist.blogmain;
        blogurl.style.display = "";
        mygitment(url);
      }
      return;
    }catch (e){
      alert(e);
    }
  }
  function mygitment(url) {
    container.style.display = "";
    var gitment = new Gitment({
      // id: url, // 可选。默认为 location.href
      owner: 'jsonlog',
      repo: 'myspringblog',
      oauth: {
        client_id: '66a595b4bcb2d43ec283',
        client_secret: 'ab351cbabd4121e4626a2c85b0ba4426fd85c414',
      },
    })
    gitment.render('container')
  }
  function tagClick(tag) {
    try {
      var count = new Array();
      var main = document.getElementById("main");
      var childs = main.childNodes;
      for(var i = childs.length - 1; i >= 0; i--) {
        if(childs[i].nodeName.toLowerCase().indexOf("div")!= -1)
          childs[i].style.display = "none";
      }

      var bloglist = document.getElementsByClassName("bloglist");
      bloglist[0].style.display = "";
      var ul = document.getElementById("bloglistul");
      var li = ul.getElementsByTagName("li");
      for (var i = 0; i < li.length; i++) {
        var ids = "," + li[i].id + ",";
        if (ids.indexOf("," + tag + ",") != -1) {
          li[i].style.display = '';
          count.push(li[i].title);
        } else {
          li[i].style.display = tag?'none':"";
        }
      }
      if(count.length == 1){
        // urlClick(count[0]); //只有一篇文章直接打开,不显示列表
        window.location.href += "?url="+count[0];
      }
      return;
    }catch (e){
      alert(e);
    }
  }
  function githubblogAdd() {
    for(var i = 0,len = blog.length; i < len; i++){
      if(url){
        if(blog[i] == url){
          try{
            if (document.getElementsById(url)) {
              urlClick(url);
              console("notfirsttime");
              break;
            }

          }catch(e) {
          }
        }
        else
          continue;
      }
      var iframe = document.createElement('iframe');
      iframe.id = blog[i];
      iframe.src = "../"+blog[i];
      iframe.style = "display: none";
      // console.log("i"+i+"href"+iframe.src);
      iframe.onload = function(){
        // var doc = this.contentWindow.document;
        var oDiv = parent.document.createElement('div');
        var bloglist = this.contentWindow.top[this.src]._bloglist;
        var blogtags = bloglist.blogtags;
        var blogtag=blogtags.split(',');
        for(var k = 0;k<blogtag.length;k++){
          if(blogtagslist[blogtag[k]])
            blogtagslist[blogtag[k]] += ","+this.src;
          else {
            blogtagslist[blogtag[k]] = this.src;
          }
        }
        oDiv.innerHTML =
                '        <li title="'+this.id+'" id="'+bloglist.blogtags+'"> <i class="blogpic"><a><img src="./../images/9.jpg" alt=""> </a></i>\n' +
                '          <dl>\n' +
                '            <dt><a>'+bloglist.blogtitle+'</a></dt>\n' +
                '            <dd>\n' +
                '                <span class="bloginfo">'+bloglist.blogcontent+'</span>\n' +
                '                <p class="timeinfo"><span class="date">'+bloglist.blogtime +'</span><span class="tags">'+ bloglist.bloghrefs+'</span></p>\n' +
                '                <a class="read" href="?url='+this.id+'">阅读更多</a> \n' +
                '            </dd>\n' +
                '          </dl>\n' +
                '        </li>';
        parent.document.getElementById('bloglistul').appendChild(oDiv);
        if(url) urlClick(url);
        // }
        // console.log(this.id+"---"+blog.length);
        frameonload++;
        if(frameonload == blog.length){
          var cloud = parent.document.getElementById("tag");
          $.each(blogtagslist,function (index,map) {
            cloud.innerHTML += '<a href="#" onclick="tagClick(\''+index+'\');">'+index+'</a>';
          });
          share.data('asidetag',cloud.innerHTML);
        }
      };
      document.body.appendChild(iframe);
    }
  }

  // if(code){
  //   container.style.display = "";
  //   if(code == "fe1898a909c6f4fa4a2c")
  //   mygitment("blog/sample.html");
  // }
</script>
<div id="footer"></div>
<script>
  $("#footer").load("./../jsonlog/footer.html");
</script>
<script>
  $(function(){
    /* 单机li进行页面跳转 */
    $("ul li").click(function(){
      /*当前标签下的a标签*/
      var obj = $(this).children("a");
      /*获取第一个a标签，进行跳转*/
      window.location.href=$(obj[0]).attr("href");
    });
  })
</script>
<a href="#" class="cd-top">Top</a>
</body>
</html>
