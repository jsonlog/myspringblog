<!doctype html>
<html>
<head runat="server">
<meta charset="utf-8">
  <title>首页_老G博客网站</title>
  <meta name="keywords" content="个人博客,老G个人博客,个人博客模板,老G" />
  <meta name="description" content="老G个人博客，是一个支持springboot个人原创网站。" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="./css/base.css" rel="stylesheet"/>
  <link href="./css/index.css" rel="stylesheet"/>
  <link href="./css/m.css" rel="stylesheet"/>
  <script src="./js/jquery.min.js" ></script>
  <link href="./css/calendar.css" rel="stylesheet" />
  <script src="./js/calendar.js" type="text/javascript"></script>
  <script src="./js/fest.js" type="text/javascript"></script>
  <script>
    $("#header").load("./jsonlog/header.html");
  </script>
  <script src="./js/hc-sticky.js"></script>
  <script src="./js/comm.js"></script>
  <!--[if lt IE 9]>
  <script src="./js/modernizr.js"></script>
  <![endif]-->
</head>
<body>
<div id="header"></div>
<div id="wrapper" class="wrapper">
  <main id="main" class="main">
    <div class="bloglist">
      <ul id="bloglistul">
      </ul>
    </div>
    <div class="content-wrapper">
  </div>
  </main>
  <div id="aside"></div>
</div>
<script>
  $("#aside").load("./jsonlog/aside.html");
</script>
<script>
  var share={
    data:function(name,value){
      var top=window.top,
              cache=top['indexhtml']||{};
      top['indexhtml']=cache;
      return value?cache[name]=value:cache[name];
    },
    removeData:function(name){
      var cache=window.top['indexhtml'];
      if(cache&&cache[name])
      {
        delete cache[name];
      }
    }
  };
  var loc = location.href;
  var n1 = loc.length;//地址的总长度
  var n2 = loc.indexOf("=");//取得=号的位置
  if(n2 != -1)
  var tag = decodeURI(loc.substr(n2+1, n1-n2));//从=号后面的内容
  var blog;
  var blogtagslist = {};
  var bloglists = [];
  var frameonload = 0;
  githubblog();
  function githubblog() {
    $.ajax(
            {
              url: "https://api.github.com/repos/jsonlog/myspringblog/contents/src/main/resources/static/blog",
              async: false,//time
              data: {},
              type: "get",
              dataType: "json",
              success: function (data) {
                blog = [];
                if (data != null) {
                  for (var j = 0; j < data.length; j++) {
                    blog.push(data[j].path.toString().replace("src/main/resources/static/","./"));
                  }
                  // blog = ["./blog/sample.html"];//test
                  githubblogAdd();
                }
              },
              error: function () {
                console.log("githubajaxerror");
              }
            });
  }
  function githubblogAdd() {
    for(var i = 0,len = blog.length; i < len; i++){
      var iframe = document.createElement('iframe');
      iframe.id = i;
      iframe.src = blog[i];
      iframe.style = "display: none";
      console.log("i"+i+"href"+iframe.src);
      iframe.onload = function(){
        var doc = this.contentWindow.document;
        var oDiv = parent.document.createElement('div');
        var bloglist = bloglists[this.id] = iframe.contentWindow.top[this.src]._bloglist;
        var blogtags = bloglist.blogtags;
        var blogtag=blogtags.split(',');
        for(var k = 0;k<blogtag.length;k++){
          if(blogtagslist[blogtag[k]])
            blogtagslist[blogtag[k]] += ","+this.src;
          else {
            blogtagslist[blogtag[k]] = this.src;
          }
        }
        // console.log(blogtagslist);
        oDiv.innerHTML =
                '        <li id="'+bloglist.blogtags+'"> <i class="blogpic"><a><img src="./images/9.jpg" alt=""> </a></i>\n' +
                '          <dl>\n' +
                '            <dt><a>'+bloglist.blogtitle+'</a></dt>\n' +
                '            <dd>\n' +
                '                <span class="bloginfo">'+bloglist.blogcontent+'</span>\n' +
                '                <p class="timeinfo"><span class="date">'+bloglist.blogtime +'</span><span class="tags">'+ bloglist.bloghrefs+'</span></p>\n' +
                '                <a class="read" href="'+this.src+'">阅读更多</a> \n' +
                '            </dd>\n' +
                '          </dl>\n' +
                '        </li>';
        parent.document.getElementById('bloglistul').appendChild(oDiv);
        console.log(this.id+"---"+blog.length);
        frameonload++;
        if(frameonload == blog.length){
          var cloud = parent.document.getElementById("tag");
          $.each(blogtagslist,function (index,map) {
            cloud.innerHTML += '<a href="./?tag='+index+'">'+index+'</a>';
          });
          share.data('asidetag',cloud.innerHTML);
          if(tag) {
            var ul = parent.document.getElementById("bloglistul");
            var li = ul.getElementsByTagName("li");
            for (var i = 0; i < li.length; i++) {
              var ids = "," + li[i].id + ",";
              if (ids.indexOf("," + tag + ",") != -1) {
                li[i].style.display = '';
              } else {
                li[i].style.display = 'none';
              }
            }
          }
        }
      };
      document.body.appendChild(iframe);
    }
  }
</script>
<div id="footer"></div>
<script>
  $("#footer").load("./jsonlog/footer.html");
</script>
<script>
  $(function(){
    /* 单机li进行页面跳转 */
    $("ul li").click(function(){
      /*当前标签下的a标签*/
      var obj = $(this).children("a");
      /*获取第一个a标签，进行跳转*/
      window.location.href=$(obj[0]).attr("href");
    });
  })
</script>
<a href="#" class="cd-top">Top</a>
</body>
</html>
